**2025-03-17 18:30**
**Tags:** [[../2 - tags/devops]]

## Docker Basics
### Create a custom Docker image
Let's create a static page website and run it one a Python web server.

Create a directory for the Docker application and navigate to it:

```bash
mkdir pythonweb && cd pythonweb
```

Create a `Dockerfile` in the directory:

```bash
touch Dockerfile
```

Add the following lines to `Dockerfile`:

```dockerfile
FROM ubuntu:jammy
RUN apt-get update && apt-get install -y python3 --no-install-recommends
EXPOSE 8000
ENTRYPOINT ["python3", "-m", "http.server"]
```

1. `FROM ubuntu:jammy`: To pull the docker image for Ubuntu 22.04.
2. `RUN apt-get update && apt-get install -y python3 --no-install-recommends`: To update the sources list and install python3.
3. `EXPOSE 8000`: To expose port `8000` to devices outside the container. The python web server listens on port `8000` by default.
4. `ENTRYPOINT ["python3", "-m", "http.server"]`: To start the python web server when the container is executed.

`RUN` is used to specify commands that should be run when building the image.
`ENTRYPOINT` and `CMD` define commands the container executes when it launches.

Build the image:

```bash
docker build -t pythonweb:latest .
```

The `.` at the end represents the location of the `Dockerfile`. In this case it is in the CWD. Otherwise, we would have specified the directory where the `Dockerfile` is located.

Run the image `pythonweb` and map port 80 on the host machine to port 8080 one the container. This will allow users interact with the web server in the container via the host machine.

```bash
docker run -p 80:8080 -d pythonweb
```

![](../attachments/Pasted%20image%2020250317184834.png)

The Python web server works, but there is no index page, and it shows system files. Let's proceed to create an index web page, add a working directory, and update the image with the new configuration.

Create a directory to contain the web files.

```bash
mkdir ~/pythonweb/webfiles/
```

Create `index.html` in `~/pythonewb/webfiles`:

```bash
vim ~/pythonweb/webfiles/index.html
```

Add the following lines to the file:

```html
<html>
<h1>SNA Lab</h1>
	<p>SNA rocks :) </p>
</html>
```

Modify the `Dockerfile` to look like the following:

```Dockerfile
FROM ubuntu:jammy
RUN apt-get update && apt-get install -y python3 --no-install-recommends
COPUY webfiles/ /usr/share/webfiles
WORKDIR /usr/share/webfiles
EXPOSE 8000
ENTRYPOINT ["python3", "-m", "http.server"]
```

We added the following lines:
1. `COPY webfiles/ /usr/share/webfiles`: To copy the contents of `webfiles` directory to the image.
2. `WORKDIR /usr/share/webfiles`: To change the container working directory to the `/usr/share/webfiles` directory.

Check running containers, stop the container running `pythonweb`, and remove the container:

```bash
docker ps -a
docker stop <container-name>
docker rm <container-name>
```

Remove the `pythonweb` image:

```bash
docker rmi pythonweb
```

Build the image:

```
docker build -t pythonweb:latest .
```

Run the updated `pythonweb` image. This time, let's specify a container name with the `--name` flag. This is better than relying on the random names generated by Docker:

```bash
docker run -p 80:8000 -d --name snaweb-container pythonweb
```

![](../attachments/Pasted%20image%2020250317190055.png)

### Docker inspect
Docker `inspect` is used to view low-lever information on Docker objects.
Inspect the `snaweb-container` container:

```bash
docker inspect snaweb-container
```

The result JSON data that contains some useful information if analyzed properly. You can filter the results from `inspect` without manually reading everything in the large volume of output it generates. 

Get the full container ID for `snaweb-container`:

```bash
docker container inspect -f '{{.Id}}' snaweb-container
```

View the containers main process:

```bash
docker container inspect -f '{{printf "%s " .Path}}{{range .Args}}{{printf "%s " .}}{{end}}' snaweb-container
```

List all port bindings:

```bash
​​docker container inspect -f '{{range $target, $published := .NetworkSettings.Ports}}{{range $published}}{{printf "%s -> %s:%s\n" $target .HostIp .HostPort}}{{end}}{{end}}' snaweb-container
```

View the network your container is connected to:

```bash
​​docker inspect -f "{{json .NetworkSettings.Networks }}" snaweb-container
```

List the containers connected to a network with their IP addresses:

> Replace `bridge` in the command with your network name.

```bash
​docker network inspect -f '{{range .Containers}}{{printf "%s -> %s\n" .Name .IPv4Address}}{{end}}' bridge
```
